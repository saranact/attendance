<!DOCTYPE html>
<html>
<head>
  <title>Attendance Graph</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>ðŸ“Š Attendance Chart</h2>
  <canvas id="attendanceChart" width="600" height="300"></canvas>

  <script type="module">
    // ðŸ”¥ Firebase config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

   const firebaseConfig = {
      apiKey: "AIzaSyA4LJgQ7oxHk-LHNvJrnReWOP9c-WIAlDQ",
      authDomain: "sih-eca-2025.firebaseapp.com",
      projectId: "sih-eca-2025",
      storageBucket: "sih-eca-2025.appspot.com",
      messagingSenderId: "1083963361758",
      appId: "1:1083963361758:web:65841e1b6e66097e62f54f",
      measurementId: "G-GLKPFGLGC9"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadAttendance() {
      const snapshot = await getDocs(collection(db, "attendance/2025-09-05/students"));
      const students = snapshot.docs.map(doc => doc.data());

      const subjects = ["MCC","MCC_1","MPMC","CLOUD","CLOUD_1","ADHOC","ME"];
      const counts = {};
      subjects.forEach(subj => counts[subj] = {present: 0, total: 0});

      students.forEach(stu => {
        subjects.forEach(subj => {
          if (stu[subj]) {
            counts[subj].total++;
            if (stu[subj].startsWith("Present")) {
              counts[subj].present++;
            }
          }
        });
      });

      const labels = subjects;
      const data = subjects.map(s => 
        counts[s].total > 0 ? (counts[s].present / counts[s].total) * 100 : 0
      );

      // ðŸŽ¨ Chart.js
      new Chart(document.getElementById("attendanceChart"), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Attendance %',
            data: data,
            backgroundColor: "rgba(54, 162, 235, 0.6)"
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true, max: 100 }
          }
        }
      });
    }

    loadAttendance();
  </script>
</body>
</html>